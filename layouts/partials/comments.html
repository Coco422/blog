<!--
 * @Author: Ray
 * @Date: 2025-08-13 00:10:33
 * @LastEditors: Ray
 * @LastEditTime: 2025-08-13 01:05:05
 * @Description: Giscus Comments with Theme Sync
-->
<div id="giscus-container"></div>
<script>
    function getGiscusTheme() {
        return document.body.className.includes("dark") ? "transparent_dark" : "light";
    }

    let giscusAttributes = {
        "src": "https://giscus.app/client.js",
        "data-repo": "Coco422/discus",
        "data-repo-id": "R_kgDOPczXuQ",
        "data-category": "Announcements",
        "data-category-id": "DIC_kwDOPczXuc4CuF9-",
        "data-mapping": "og:title",
        "data-strict": "0",
        "data-reactions-enabled": "1",
        "data-emit-metadata": "0",
        "data-input-position": "top",
        "data-theme": getGiscusTheme(),
        "data-lang": "zh-CN",
        "data-loading": "lazy",
        "crossorigin": "anonymous",
        "async": "",
    };

    let giscusScript = document.createElement("script");
    Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
    document.getElementById("giscus-container").appendChild(giscusScript);

    // 监听主题变化
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                const iframe = document.querySelector('iframe.giscus-frame');
                if (!iframe) return;
                const message = {
                    setConfig: {
                        theme: getGiscusTheme()
                    }
                };
                iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
            }
        });
    });
    observer.observe(document.body, { attributes: true });
</script>
{{/* 计算行数 */}}
{{ $lines := (len (split .Inner "\n")) }}
{{ $autoThreshold := 15 }} {{/* 超过多少行自动折叠，自行调整 */}}

{{ $needCollapse := ge $lines $autoThreshold }}

{{ if $needCollapse }}
<details class="code-details">
  <summary>
      <span>{{ if .Type }}[{{ .Type }}] {{ end }}显示已折叠代码（{{ $lines }} 行）</span>
  </summary>
  <div class="collapsible-content">
{{ end }}

{{ $r := transform.HighlightCodeBlock . }}
{{ $r.Wrapped }}

{{ if $needCollapse }}
  </div>
</details>
{{ end }}
